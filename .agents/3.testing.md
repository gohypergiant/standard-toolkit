## 3. Testing Style and Conventions

Use `vitest` framework. Design tests to be short, simple, flat, and instantly understandable.

### Test Structure

Use `it()` with sentence-style descriptions:

```ts
describe('ProductsService', () => {
  describe('Add new product', () => {
    it('should have status "pending approval" when no price is specified', () => {
      const newProduct = new ProductService().add(/*...*/);
      expect(newProduct.status).toEqual('pendingApproval');
    });
  });
});
```

### AAA Pattern

Structure tests as **Arrange**, **Act**, **Assert**:

```ts
it('should return the default value for an unknown property', () => {
  // Arrange
  const defaultColor: Color = [128, 128, 128, 155];
  const colorLookup = lookup(colorTable, defaultVal(defaultColor));

  // Act
  const actual = colorLookup('UNKNOWN');

  // Assert
  expect(actual).toEqual(defaultColor);
});
```

### Assertions

Use strict assertions:

```ts
// ðŸ›‘ Bad
expect(content).toContain('valid-content');

// âœ… Better
expect(content).toEqual({ key: 'valid-content' });

// â­ Best
expect(content).toStrictEqual({ key: 'valid-content' });
```

### Parameterized Tests

One behavior per test. Use `it.each` for variations:

```ts
describe('factorial', () => {
  it.each([
    { input: 0, expected: 1 },
    { input: 1, expected: 1 },
    { input: 5, expected: 120 },
    { input: 7, expected: 5040 },
  ])('should return $expected when given $input', ({ input, expected }) => {
    expect(factorial(input)).toBe(expected);
  });

  it('should throw when the input is negative', () => {
    expect(() => factorial(-1)).toThrow('Number must not be negative');
  });
});
```

### Test Doubles

Prefer in this order:

1. **Fakes**: Lightweight in-memory implementations
2. **Stubs**: Pre-configured responses
3. **Spies/Mocks**: Interaction verification (last resort)

**Avoid over-mocking:**

- Only mock what you don't control (third-party libraries, networks, file systems)
- Don't mock pure functions or internal helpers
- Don't mock our own code
- Prefer record/replay frameworks over manual mocking

### Test Organization

- Place test files next to implementation (`foo.ts` / `foo.test.ts`)
- One test file per module or class
- Keep test files under 200-300 lines
- Store reusable setup in `fixtures/` or `test-utils/`
