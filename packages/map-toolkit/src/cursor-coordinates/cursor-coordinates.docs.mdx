import { Canvas, Meta } from '@storybook/addon-docs/blocks';

import * as CursorCoordinatesStories from './cursor-coordinates.stories';

<Meta of={CursorCoordinatesStories} />

# Cursor Coordinates
A hook that retrieves the coordinates of the mouse's current hovered position on a BaseMap.

## Features

- **Multiple Coordinate Formats**: Supports DD (Decimal Degrees), DDM (Degrees Decimal Minutes), DMS (Degrees Minutes Seconds), MGRS, and UTM formats
- **Raw Coordinate Access**: Direct access to longitude and latitude values for custom processing
- **Custom Formatters**: Supply your own formatting function for complete control over output
- **Hybrid Architecture**: React integration uses `useSyncExternalStore` for concurrent-safe updates
- **SSR/RSC Compatible**: Full support for server-side rendering and React Server Components
- **Instance Isolation**: Support for multiple independent map instances
- **Efficient Fan-out**: Single bus listener per map instance, regardless of component subscribers
- **Automatic Cleanup**: State is cleaned up when all subscribers unmount

## Dependencies

Cursor Coordinates requires the following dependencies:

**Required:**
- [`@accelint/bus`](https://github.com/gohypergiant/standard-toolkit/tree/main/packages/bus) - Event bus for decoupled communication between map components
- [`@accelint/core`](https://github.com/gohypergiant/standard-toolkit/tree/main/packages/core) - Core utilities including unique ID generation
- [`@accelint/geo`](https://github.com/gohypergiant/standard-toolkit/tree/main/packages/geo) - Geographic coordinate system conversion utilities

**React Integration:**
- `react` - React 19.0.0 or higher for the `useCursorCoordinates` hook and context

**Installation:**

```bash
npm install @accelint/map-toolkit @accelint/bus @accelint/core @accelint/geo react
# or
pnpm add @accelint/map-toolkit @accelint/bus @accelint/core @accelint/geo react
```

## Example usage

### Basic Usage
```tsx
import { uuid } from '@accelint/core';
import { BaseMap } from '@accelint/map-toolkit/deckgl';
import { useCursorCoordinates } from '@accelint/map-toolkit/cursor-coordinates';
import { useEffect } from 'react';

// Module-level constant shared across components
const MAIN_MAP_ID = uuid();

function CursorCoordinateDisplay() {
  const { formattedCoord, setFormat } = useCursorCoordinates(MAIN_MAP_ID);

  useEffect(() => {
    setFormat('mgrs');
  }, [setFormat]);

  return (
    <div className="absolute top-0 left-0 size-[300px] h-auto">
      {formattedCoord}
    </div>
  );
}

export function App() {
  return (
    <div className="relative w-full h-full">
      <BaseMap id={MAIN_MAP_ID} className="absolute inset-0" />
      <CursorCoordinateDisplay />
    </div>
  );
}
```

### With Custom Formatter
```tsx
import { useCursorCoordinates } from '@accelint/map-toolkit/cursor-coordinates';

function CustomCoordinateDisplay() {
  const { formattedCoord } = useCursorCoordinates(MAIN_MAP_ID, {
    formatter: (coord) =>
      `Lat: ${coord.latitude.toFixed(6)}° Lng: ${coord.longitude.toFixed(6)}°`,
  });

  return <div>{formattedCoord}</div>;
}
```

### Accessing Raw Coordinates
```tsx
import { useCursorCoordinates } from '@accelint/map-toolkit/cursor-coordinates';

function RawCoordinateDisplay() {
  const { rawCoord, currentFormat } = useCursorCoordinates(MAIN_MAP_ID);

  if (!rawCoord) {
    return <div>Move cursor over map</div>;
  }

  return (
    <div>
      <div>Longitude: {rawCoord.longitude}</div>
      <div>Latitude: {rawCoord.latitude}</div>
      <div>Current Format: {currentFormat}</div>
    </div>
  );
}
```

## React API Reference

### `useCursorCoordinates(id?, options?)`

Hook to access hovered coordinate of a map instance.

#### Parameters

##### `id?: UniqueId`

The map ID to access. **Recommended**: Always pass this parameter for UI components that are siblings to `BaseMap`.

##### `options?: UseCursorCoordinatesOptions`

Optional configuration object:

| Property | Type | Description |
|----------|------|-------------|
| `formatter` | `CoordinateFormatter` | Custom formatter function. Takes precedence over built-in format for `formattedCoord`. |

#### Returns

```tsx
{
  formattedCoord: string;                               // Formatted coordinate string (using current format or custom formatter)
  setFormat: (format: CoordinateFormatTypes) => void;  // Set the coordinate format system
  rawCoord: RawCoordinate;                              // Raw coordinate data (null when cursor not over map)
  currentFormat: CoordinateFormatTypes;                 // Current active format type
}
```

#### Types

##### `RawCoordinate`

```tsx
{
  longitude: number;           // Longitude in degrees (-180 to 180, normalized)
  latitude: number;            // Latitude in degrees (-90 to 90)
} | null
```

##### `CoordinateFormatter`

```tsx
(coordinate: NonNullable<RawCoordinate>) => string
```

##### `CoordinateFormatTypes`

`'dd'` | `'ddm'` | `'dms'` | `'mgrs'` | `'utm'`

| Format | Description | Example |
|--------|-------------|---------|
| `dd` | Decimal Degrees | `40.712775° N / 74.005973° W` |
| `ddm` | Degrees Decimal Minutes | `40° 42.7665' N / 74° 0.3584' W` |
| `dms` | Degrees Minutes Seconds | `40° 42' 45.99″ N / 74° 0' 21.50″ W` |
| `mgrs` | Military Grid Reference System | `18T WL 83959 07350` |
| `utm` | Universal Transverse Mercator | `18N 583959 4507351` |

#### Throws

- `Error` if no `id` is provided and hook is used outside of `MapProvider`

## Events

Cursor Coordinates listens for hover events using `@accelint/bus`. `BaseMap` instances handle this automatically.
If using an alternative map component, import `MapEvents.hover` from `@accelint/map-toolkit/deckgl/base-map`
and emit hover events on the event bus with the coordinate data to integrate with this hook.

[Github Source](https://github.com/gohypergiant/standard-toolkit)
