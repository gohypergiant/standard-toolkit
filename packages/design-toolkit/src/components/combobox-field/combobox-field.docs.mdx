import { Canvas, Meta } from '@storybook/addon-docs/blocks';

import * as ComboBoxStories from './combobox-field.stories';

<Meta of={ComboBoxStories} />

# ComboBoxField

Accessible searchable combobox with dropdown options. Built on React Aria Components with virtualization support and flexible content organization.

Uses the [Options](?path=/docs/components-options--playground) component system for rendering dropdown items.

## Example Usage

### Basic
```tsx
<ComboBoxField defaultItems={items} label="Select animal">
  {(item) => (
    <OptionsItem key={item.id} textValue={item.name}>
      <Icon>{item.prefixIcon}</Icon>
      <OptionsItemContent>
        <OptionsItemLabel>{item.name}</OptionsItemLabel>
        <OptionsItemDescription>{item.description}</OptionsItemDescription>
      </OptionsItemContent>
    </OptionsItem>
  )}
</ComboBoxField>
```
<Canvas of={ComboBoxStories.Default} />

### With Sections
```tsx
<ComboBoxField defaultItems={itemsWithSections}>
  {(section) => (
    <OptionsSection header={section.name} items={section.children}>
      {(item) => (
        <OptionsItem key={item.id} textValue={item.name}>
          <OptionsItemLabel>{item.name}</OptionsItemLabel>
        </OptionsItem>
      )}
    </OptionsSection>
  )}
</ComboBoxField>
```
<Canvas of={ComboBoxStories.WithDynamicSections} />

### With Many Items (Virtualized)
```tsx
<ComboBoxField defaultItems={manyItems} layoutOptions={{ rowHeight: 32 }}>
  {(item) => (
    <OptionsItem key={item.id} textValue={item.name}>
      <OptionsItemLabel>{item.name}</OptionsItemLabel>
    </OptionsItem>
  )}
</ComboBoxField>
```
<Canvas of={ComboBoxStories.WithManyItems} />

### Custom Value
```tsx
<ComboBoxField defaultItems={items} allowsCustomValue onInputChange={setValue}>
  {(item) => <OptionsItem key={item.id} textValue={item.name}>{item.name}</OptionsItem>}
</ComboBoxField>
```
<Canvas of={ComboBoxStories.WithCustomValue} />

### Readonly
```tsx
<ComboBoxField defaultItems={items} inputProps={{ value: 'Display value' }} isReadOnly>
  {(item) => <OptionsItem key={item.id} textValue={item.name}>{item.name}</OptionsItem>}
</ComboBoxField>
```
<Canvas of={ComboBoxStories.Readonly} />

## Sizes

| Size | Description |
|------|-------------|
| `medium` | Standard size with visible label (default) |
| `small` | Compact size, label and description hidden |

## Props
Extends [`ComboBox`](https://react-spectrum.adobe.com/react-aria/ComboBox.html#props) props from react-aria-components.

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `label` | `string` | - | Label text (hidden in small size) |
| `description` | `string` | - | Helper text (hidden in small size or when invalid) |
| `errorMessage` | `string` | - | Error message when invalid |
| `size` | `'medium' \| 'small'` | `'medium'` | Size variant |
| `layoutOptions` | `ListLayoutOptions` | - | Virtualization config (e.g., `{ estimatedRowHeight: 46 }`) |
| `inputProps` | `InputProps` | - | Props passed to the input element |
| `defaultItems` | `Iterable<T>` | - | Items for dynamic rendering |
| `items` | `Iterable<T>` | - | Controlled items |
| `allowsCustomValue` | `boolean` | `false` | Allow values not in the list |
| `isReadOnly` | `boolean` | `false` | Readonly state |
| `isDisabled` | `boolean` | `false` | Disabled state |
| `isRequired` | `boolean` | `false` | Required field |
| `isInvalid` | `boolean` | - | Invalid state |
| `menuTrigger` | `'focus' \| 'input' \| 'manual'` | `'focus'` | When to show dropdown |
| `onSelectionChange` | `(key: Key) => void` | - | Called when selection changes |
| `onInputChange` | `(value: string) => void` | - | Called when input changes |
| `classNames` | `object` | - | Custom classes (see below) |

**classNames:**

| Key | Description |
|-----|-------------|
| `field` | Main field container |
| `label` | Label styling |
| `control` | Input and trigger container |
| `input` | Input field |
| `trigger` | Dropdown trigger button |
| `description` | Description text |
| `error` | Error message |
| `popover` | Dropdown popover |

### ComboBoxFieldProvider
Context provider for setting default props across multiple ComboBoxField components.

```tsx
<ComboBoxFieldProvider size="small">
  <ComboBoxField defaultItems={items1}>{...}</ComboBoxField>
  <ComboBoxField defaultItems={items2}>{...}</ComboBoxField>
</ComboBoxFieldProvider>
```

## Accessibility
- Keyboard: Arrow keys to navigate, Enter to select, Escape to close
- Type-ahead filtering as you type
- ARIA attributes for screen readers
- Focus management between input and dropdown

## Implementation Notes
- Wraps `ComboBox` from react-aria-components with `Virtualizer` for large lists
- Uses the [Options](?path=/docs/components-options--playground) component system for dropdown content
- Supports both static children and dynamic `defaultItems`/`items` rendering

**Related:**
- [React Aria ComboBox](https://react-spectrum.adobe.com/react-aria/ComboBox.html)
- [Options Component](?path=/docs/components-options--playground)
- [Github Source](https://github.com/gohypergiant/standard-toolkit/tree/main/packages/design-toolkit/src/components/combobox-field)
