import { Meta, Canvas } from '@storybook/addon-docs/blocks';

import * as QueryBuilderStories from './query-builder.stories';

<Meta of={QueryBuilderStories} />

# QueryBuilder

A visual interface for building complex query rulesets and filters. Built on [React Query Builder](https://react-querybuilder.js.org/), it provides an intuitive UI for constructing database queries with support for multiple conditions, operators, and logical grouping.

<Canvas of={QueryBuilderStories.Default} />

## Basic

```tsx
<QueryBuilder
  fields={[
    { name: 'firstName', label: 'First Name' },
    { name: 'lastName', label: 'Last Name' },
    { name: 'age', label: 'Age', inputType: 'number' },
  ]}
  query={{
    combinator: 'and',
    rules: [{ field: 'firstName', operator: '=', value: '' }],
  }}
  onQueryChange={handleQueryChange}
/>
```

## Props

### QueryBuilder

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `fields` | `Field[]` | Required | Available fields for rules |
| `query` | `RuleGroupType` | Required | Current query state |
| `onQueryChange` | `(query: RuleGroupType) => void` | Required | Query change handler |
| `orientation` | `'horizontal' \| 'vertical'` | `'horizontal'` | Rule layout direction |
| `showRuleLines` | `boolean` | `true` | Show connecting lines between rules |
| `showCloneButtons` | `boolean` | `false` | Show clone buttons on rules/groups |
| `showLockButtons` | `boolean` | `false` | Show lock buttons on rules/groups |
| `controlElements` | `object` | - | Custom component overrides |
| `controlClassnames` | `object` | - | Custom class name overrides |

## Component Structure

### Main Components
- **QueryBuilder**: Main wrapper that manages query state
- **Rule**: Individual rule with field, operator, and value
- **RuleGroup**: Container for rules with shared combinator
- **ValueEditor**: Input for editing rule values (text, checkbox, radio, select, switch, textarea)
- **ValueSelector**: Dropdown for selecting predefined values

### Supporting Components
- **RuleGroupHeaderComponent**: Header section containing group actions
- **RuleGroupFooterComponent**: Footer section with add rule/group actions
- **CombinatorSelector**: AND/OR toggle for rule groups

### Action Components
- **ActionElement**: Base component for rule/group actions
- **RemoveRuleAction**: Delete button for rules/groups
- **LockAction**: Lock/unlock toggle for rules/groups
- **CloneAction**: Duplicate button for rules/groups

## Usage Notes

- Supports horizontal and vertical layouts via `orientation` prop
- Rules can be added, removed, cloned, and grouped
- Groups support AND/OR combinators
- Validation runs on value changes
- Drag and drop is disabled by default

## Accessibility

- ARIA labels on all interactive elements
- Keyboard navigation (Tab, Space/Enter, arrow keys)
- Screen reader announcements for actions
- High contrast icons and borders

## Related

- [React Query Builder](https://react-querybuilder.js.org/)
- [GitHub Source](https://github.com/gohypergiant/standard-toolkit/tree/main/packages/design-toolkit/src/components/query-builder)
