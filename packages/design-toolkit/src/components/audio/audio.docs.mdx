import { Canvas, Meta } from '@storybook/addon-docs/blocks';

import * as AudioStories from './audio.stories';

<Meta of={AudioStories} />

# Audio

The Audio component wraps an HTML audio element with MediaControls, providing playback controls, seek functionality, volume control, and playback rate adjustment.

Built on [media-chrome](https://www.media-chrome.org/) for state management and accessibility.

It is composed of the following components:

- **Audio** - Main audio player component with integrated controls
- **PlayButton** - Play/pause toggle button
- **MuteButton** - Mute/unmute toggle button
- **VolumeSlider** - Volume level slider
- **TimeRange** - Seek/scrub bar for audio position
- **TimeDisplay** - Current time or duration display
- **SeekButton** - Skip forward/backward button
- **PlaybackRateButton** - Playback speed selector

## Example usage

```tsx
// Basic usage
<Audio src="audio.mp3" title="My Audio File" />

// With event callbacks
<Audio
  src="audio.mp3"
  title="My Audio File"
  onPlay={() => console.log('Playing')}
  onPause={() => console.log('Paused')}
  onEnded={() => console.log('Ended')}
  onTimeUpdate={(time) => console.log('Current time:', time)}
/>

// Custom controls layout
<Audio src="audio.mp3">
  <div className="flex items-center gap-2">
    <PlayButton />
    <TimeRange />
    <MuteButton />
  </div>
</Audio>
```

<Canvas of={AudioStories.Default} />

## With Title

Display a title above the controls, useful for showing the filename or track name.

<Canvas of={AudioStories.WithTitle} />

## Events

The Audio component provides callbacks for common media events.

<Canvas of={AudioStories.Events} />

## Props

### Audio Props
* **`src`** - Audio source URL (string)
* **`title`** - Optional title to display above the controls
* **`autoPlay`** - Whether to start playing automatically (note: browsers may block this)
* **`loop`** - Whether to loop the audio when it ends
* **`muted`** - Whether to start muted
* **`preload`** - Preload behavior: `'none'` | `'metadata'` (default) | `'auto'`
* **`crossOrigin`** - CORS setting: `''` | `'anonymous'` | `'use-credentials'`
* **`isDisabled`** - Disable all controls
* **`playbackRates`** - Custom playback rate options (default: `[1, 2, 3]`)
* **`children`** - Custom controls (replaces default layout)

### Event Callbacks
* **`onPlay`** - `(e: SyntheticEvent<HTMLAudioElement>) => void` - Called when playback starts
* **`onPause`** - `(e: SyntheticEvent<HTMLAudioElement>) => void` - Called when playback pauses
* **`onEnded`** - `() => void` - Called when audio finishes playing
* **`onTimeUpdate`** - `(currentTime: number) => void` - Called during playback with current time in seconds
* **`onLoadedMetadata`** - `(e: SyntheticEvent<HTMLAudioElement>) => void` - Called when audio metadata is loaded
* **`onError`** - `(error: MediaError | null) => void` - Called when audio fails to load

### classNames
* **`classNames.container`** - Applied to the main container
* **`classNames.title`** - Applied to the title element
* **`classNames.timeRow`** - Applied to the time/seek row
* **`classNames.controlsRow`** - Applied to the controls row
* **`classNames.mediaControls`** - Applied to the media controls wrapper

## Implementation Notes

The `Audio` component wraps the HTML `<audio>` element and uses media-chrome for state management. It automatically includes `MediaProvider` context, so child control components can access media state without additional setup.

### Default Controls

The `Audio` component includes more controls than `MediaControls` by default:
- **Time row**: Current time display, seek bar, duration display
- **Controls row**: Mute button, volume slider, seek backward, play/pause, seek forward, playback rate

This differs from `MediaControls`'s default which only includes: play, time display, time range, mute, and volume. Use `Audio` when you need all controls. Use `MediaControls` directly to customize which controls appear.

[media-chrome Docs](https://www.media-chrome.org/docs)

[GitHub Source](https://github.com/gohypergiant/standard-toolkit/tree/main/packages/design-toolkit/src/components/audio)

The underlying elements are:
- `media-controller` for the accessible media chrome container
- `audio` element for the actual audio playback
- Various control components (PlayButton, TimeRange, etc.) for user interaction

The component automatically handles accessibility features including:
- ARIA attributes for screen readers
- Keyboard navigation for all controls
- Focus management
- Proper labeling of interactive elements
