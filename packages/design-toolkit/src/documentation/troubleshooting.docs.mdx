import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Troubleshooting" />

# Troubleshooting CSS Modules

Common issues and solutions when working with CSS Modules in the Design Toolkit.

## CSS Modules Not Loading

**Symptoms**: Components render with no styles at all.

**Checklist**:
1. ✅ Design foundation styles imported in `globals.css`? (`@import '@accelint/design-foundation/styles';`)
    - Ensure `globals.css` is being imported in the application.
2. ✅ CSS modules enabled in build tool? (Next.js: built-in, Vite: check config)
3. ✅ Import path uses `.module.css` extension?
4. ✅ CSS file exists and is in correct location?
5. ✅ Build completed successfully without errors?
6. ✅ Check browser DevTools: are CSS files being loaded?

**Still not working?** Clear build cache and restart dev server:
```bash
rm -rf .next dist node_modules/.vite
pnpm install
pnpm dev
```

## Path Aliases Inside CSS Files

**Problem**: In NextJS, directly using aliases (like `@/` or `~/`) inside CSS files, including CSS Modules. Attempting to use them can result in "Module not found" errors.  This is because the standard CSS loader do not automatically resolve the aliases in the name manner as JS/TS imports. This is a known NextJS limitation that affects imports and `@reference` directives in CSS files.

```css
/* ❌ WRONG - Path aliases don't work in CSS */
@import '@/styles/globals.css';
```

**Solution**:
Add to your package.json the imports property below, with the specific path to include. The `"imports"` field defines [subpath imports](https://nodejs.org/api/packages.html#subpath-imports), a standard Node.js feature that both the JavaScript/TypeScript toolchain and CSS loaders respect. Unlike path aliases (which are TypeScript-specific configuration), subpath imports work uniformly across the entire build pipeline, including CSS Modules.

```json
{
  "imports": {
    "#globals": "./src/styles/globals.css"
  }
}
```

This allows the *.module.css to `@reference '#globals`';


## Common Mistakes

### Using external `composes` in CSS Modules
**Problem**: Styles from external files appear missing or unstyled.

```css
/* ❌ WRONG - Bypasses Tailwind processing */
@reference '../other/styles.module.css';

.button {
  composes: baseButton from '../other/styles.module.css';
}
```

**Solution**: Compose in JSX instead.
```tsx
/* ✅ CORRECT */
import otherStyles from '../other/styles.module.css';
import styles from './styles.module.css';

<button className={clsx(otherStyles.baseButton, styles.button)} />
```

### Forgetting to configure named group hashing
**Problem**: Group-based state styling doesn't work (e.g., `group-hover/button:scale-110` has no effect).

**Root Cause**: Build tool is hashing `group/button` classes, breaking Tailwind's group selector pattern.

**Solution**: Ensure you've configured the `@accelint/postcss-tailwind-css-modules` plugin as shown in the [Upgrade Guide](?path=/docs/upgrade-guides--docs#prevent-hashing-of-tailwind-named-groups).

**To verify**: Inspect the compiled CSS output. If named groups are being hashed, you'll see selectors like:

```css
/* ❌ WRONG - group name is hashed, breaking the selector */
&:is(:where(.styles_group__accordion_abc12):where([disabled])) {
  cursor: not-allowed;
}
```

The class should remain unhashed:

```css
/* ✅ CORRECT - group name preserved */
&:is(:where(.group\/accordion):where([disabled])) {
  cursor: not-allowed;
}
```

### Using wrong layer for overrides
**Problem**: Custom styles are ignored or component styles bleed through.

```css
/* ❌ WRONG - Using same layer as design toolkit */
@layer components.l1 {
  .button {
    @apply bg-red-500;  /* Won't override DTK button */
  }
}
```

**Solution**: Use higher precedence layers for application components.
```css
/* ✅ CORRECT - Application components use l3+ */
@layer components.l3 {
  .customButton {
    @apply bg-red-500;  /* Will override properly */
  }
}

/* ✅ CORRECT - Inline utility overrides */
<Button className="bg-red-500" />  {/* Utilities always win */}
```
